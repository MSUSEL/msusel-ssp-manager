{"platform":{"name":"ubuntu","release":"24.04","target_id":"d2111083-60e2-528a-8a75-14e2e2460ed3"},"profiles":[{"name":"tests from inspec.controls.audit_review_test.rb","sha256":"eedff050cf42c6331ce5a8f91436c61e3e11a8c74b091c8bfd4ec909c427f24c","title":"tests from inspec/controls/audit_review_test.rb","supports":[],"attributes":[],"groups":[{"id":"audit_review_test.rb","controls":["audit-review"]}],"controls":[{"id":"audit-review","title":"Validate Audit Review, Analysis, and Reporting Controls","desc":"Ensure that the system reviews, analyzes, and reports audit records appropriately (AU-6)","descriptions":[{"label":"default","data":"Ensure that the system reviews, analyzes, and reports audit records appropriately (AU-6)"}],"impact":1.0,"refs":[],"tags":{},"code":"control 'audit-review' do\n  impact 1.0\n  title 'Validate Audit Review, Analysis, and Reporting Controls'\n  desc 'Ensure that the system reviews, analyzes, and reports audit records appropriately (AU-6)'\n\n  app_url = 'http://localhost:8000'\n  log_file_path = './logs/opa_interactions.log'\n  audit_log_path = './logs/audit.log'\n\n  # Test case 1: Verify audit review configuration\n  describe 'Audit review configuration' do\n    # Get review configuration information\n    review_config_response = http(\"#{app_url}/audit_review_config\",\n                              method: 'GET',\n                              headers: {\n                                'Content-Type' => 'application/json',\n                                'Authorization' => 'Bearer admin_user_token'\n                              })\n\n    review_config = JSON.parse(review_config_response.body)\n\n    it 'should have review enabled' do\n      unless review_config['review_enabled'] == true\n        fail \"Audit review is not enabled\"\n      end\n    end\n\n    it 'should have appropriate review frequency' do\n      unless review_config['review_frequency_hours'] <= 24\n        fail \"Review frequency too long: #{review_config['review_frequency_hours']} hours (should be <= 24)\"\n      end\n    end\n\n    it 'should have reviewers configured' do\n      unless review_config['reviewers'] && review_config['reviewers'].length > 0\n        fail \"No reviewers configured for audit review\"\n      end\n    end\n\n    it 'should have automated review enabled' do\n      unless review_config['automated_review_enabled'] == true\n        fail \"Automated audit review is not enabled\"\n      end\n    end\n\n    it 'should have automated tools configured' do\n      unless review_config['automated_tools'] && review_config['automated_tools'].length > 0\n        fail \"No automated tools configured for audit review\"\n      end\n    end\n  end\n\n  # Test case 2: Verify audit analysis configuration\n  describe 'Audit analysis configuration' do\n    # Get analysis configuration information\n    analysis_config_response = http(\"#{app_url}/audit_analysis_config\",\n                                method: 'GET',\n                                headers: {\n                                  'Content-Type' => 'application/json',\n                                  'Authorization' => 'Bearer admin_user_token'\n                                })\n\n    analysis_config = JSON.parse(analysis_config_response.body)\n\n    it 'should have analysis enabled' do\n      unless analysis_config['analysis_enabled'] == true\n        fail \"Audit analysis is not enabled\"\n      end\n    end\n\n    it 'should have analysis methods configured' do\n      unless analysis_config['analysis_methods'] && analysis_config['analysis_methods'].length > 0\n        fail \"No analysis methods configured for audit analysis\"\n      end\n    end\n\n    it 'should have correlation enabled' do\n      unless analysis_config['correlation_enabled'] == true\n        fail \"Audit correlation is not enabled\"\n      end\n    end\n\n    it 'should have correlation methods configured' do\n      unless analysis_config['correlation_methods'] && analysis_config['correlation_methods'].length > 0\n        fail \"No correlation methods configured for audit analysis\"\n      end\n    end\n  end\n\n  # Test case 3: Verify audit reporting configuration\n  describe 'Audit reporting configuration' do\n    # Get reporting configuration information\n    reporting_config_response = http(\"#{app_url}/audit_reporting_config\",\n                                  method: 'GET',\n                                  headers: {\n                                    'Content-Type' => 'application/json',\n                                    'Authorization' => 'Bearer admin_user_token'\n                                  })\n\n    reporting_config = JSON.parse(reporting_config_response.body)\n\n    it 'should have reporting enabled' do\n      unless reporting_config['reporting_enabled'] == true\n        fail \"Audit reporting is not enabled\"\n      end\n    end\n\n    it 'should have appropriate reporting frequency' do\n      unless reporting_config['reporting_frequency_hours'] <= 168\n        fail \"Reporting frequency too long: #{reporting_config['reporting_frequency_hours']} hours (should be <= 168)\"\n      end\n    end\n\n    it 'should have report recipients configured' do\n      unless reporting_config['report_recipients'] && reporting_config['report_recipients'].length > 0\n        fail \"No recipients configured for audit reporting\"\n      end\n    end\n  end\n\n  # Test case 4: Verify risk-based adjustment configuration\n  describe 'Risk-based adjustment configuration' do\n    # Get risk adjustment configuration information\n    risk_config_response = http(\"#{app_url}/audit_risk_config\",\n                              method: 'GET',\n                              headers: {\n                                'Content-Type' => 'application/json',\n                                'Authorization' => 'Bearer admin_user_token'\n                              })\n\n    risk_config = JSON.parse(risk_config_response.body)\n\n    it 'should have risk-based adjustment enabled' do\n      unless risk_config['risk_adjustment_enabled'] == true\n        fail \"Risk-based adjustment is not enabled\"\n      end\n    end\n\n    it 'should have risk levels configured' do\n      unless risk_config['risk_levels'] && risk_config['risk_levels'].length > 0\n        fail \"No risk levels configured for risk-based adjustment\"\n      end\n    end\n  end\n\n  # Test case 5: Verify OPA policy validation\n  describe 'OPA policy validation for audit review' do\n    # Check OPA logs for audit review validation\n    opa_log_content = file(log_file_path).content\n\n    it 'should contain audit review validation in OPA logs' do\n      keywords = %w[audit_review_configured audit_analysis_configured correlation_configured audit_reporting_configured risk_adjustment_configured findings_reported]\n      missing_keywords = keywords.reject { |keyword| opa_log_content.include?(keyword) }\n\n      unless missing_keywords.empty?\n        fail \"OPA logs do not contain audit review validation keywords: #{missing_keywords.join(', ')}\"\n      end\n    end\n  end\n\n  # Test case 6: Verify audit findings reporting\n  describe 'Audit findings reporting' do\n    # Get findings information\n    findings_response = http(\"#{app_url}/audit_findings\",\n                            method: 'GET',\n                            headers: {\n                              'Content-Type' => 'application/json',\n                              'Authorization' => 'Bearer admin_user_token'\n                            })\n\n    findings = JSON.parse(findings_response.body)\n\n    it 'should have findings available' do\n      unless findings['findings'] && findings['findings'].length > 0\n        fail \"No audit findings available\"\n      end\n    end\n\n    it 'should include required information in findings' do\n      if findings['findings'] && findings['findings'].length > 0\n        finding = findings['findings'][0]\n        missing_fields = []\n\n        missing_fields << 'timestamp' unless finding['timestamp']\n        missing_fields << 'severity' unless finding['severity']\n        missing_fields << 'description' unless finding['description']\n        missing_fields << 'affected_resources' unless finding['affected_resources']\n\n        unless missing_fields.empty?\n          fail \"Findings missing required fields: #{missing_fields.join(', ')}\"\n        end\n      end\n    end\n  end\n\n  # Test case 7: Verify audit review process\n  describe 'Audit review process' do\n    # Simulate audit review\n    simulate_response = http(\"#{app_url}/simulate_audit_review\",\n                            method: 'POST',\n                            headers: {\n                              'Content-Type' => 'application/json',\n                              'Authorization' => 'Bearer admin_user_token'\n                            },\n                            data: { review_type: 'scheduled' }.to_json)\n\n    simulate_result = JSON.parse(simulate_response.body)\n\n    it 'should complete the review process' do\n      unless simulate_result['review_completed'] == true\n        fail \"Audit review process did not complete\"\n      end\n    end\n\n    it 'should analyze audit records' do\n      unless simulate_result['records_analyzed'] > 0\n        fail \"No audit records were analyzed\"\n      end\n    end\n\n    it 'should identify findings if applicable' do\n      unless simulate_result['findings_identified'] != nil\n        fail \"Findings identification status not reported\"\n      end\n    end\n\n    it 'should report findings to recipients' do\n      if simulate_result['findings_identified'] == true\n        unless simulate_result['findings_reported'] == true\n          fail \"Findings were identified but not reported\"\n        end\n      end\n    end\n  end\n\n  # Test case 8: Verify integration with risk assessment\n  describe 'Integration with risk assessment' do\n    # Simulate risk level change\n    risk_response = http(\"#{app_url}/simulate_risk_change\",\n                        method: 'POST',\n                        headers: {\n                          'Content-Type' => 'application/json',\n                          'Authorization' => 'Bearer admin_user_token'\n                        },\n                        data: { risk_level: 'high' }.to_json)\n\n    risk_result = JSON.parse(risk_response.body)\n\n    it 'should adjust review frequency based on risk' do\n      unless risk_result['review_frequency_adjusted'] == true\n        fail \"Review frequency not adjusted based on risk\"\n      end\n    end\n\n    it 'should adjust analysis methods based on risk' do\n      unless risk_result['analysis_methods_adjusted'] == true\n        fail \"Analysis methods not adjusted based on risk\"\n      end\n    end\n\n    it 'should adjust reporting frequency based on risk' do\n      unless risk_result['reporting_frequency_adjusted'] == true\n        fail \"Reporting frequency not adjusted based on risk\"\n      end\n    end\n  end\nend\n","source_location":{"line":1,"ref":"inspec/controls/audit_review_test.rb"},"waiver_data":{},"results":[{"status":"passed","code_desc":"Audit review configuration should have review enabled","run_time":0.000238246,"start_time":"2025-05-04T22:09:08-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Audit review configuration"},{"status":"passed","code_desc":"Audit review configuration should have appropriate review frequency","run_time":8.1703e-05,"start_time":"2025-05-04T22:09:08-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Audit review configuration"},{"status":"passed","code_desc":"Audit review configuration should have reviewers configured","run_time":5.2579e-05,"start_time":"2025-05-04T22:09:08-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Audit review configuration"},{"status":"passed","code_desc":"Audit review configuration should have automated review enabled","run_time":5.4312e-05,"start_time":"2025-05-04T22:09:08-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Audit review configuration"},{"status":"passed","code_desc":"Audit review configuration should have automated tools configured","run_time":4.5275e-05,"start_time":"2025-05-04T22:09:08-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Audit review configuration"},{"status":"passed","code_desc":"Audit analysis configuration should have analysis enabled","run_time":5.5755e-05,"start_time":"2025-05-04T22:09:08-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Audit analysis configuration"},{"status":"passed","code_desc":"Audit analysis configuration should have analysis methods configured","run_time":5.0034e-05,"start_time":"2025-05-04T22:09:08-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Audit analysis configuration"},{"status":"passed","code_desc":"Audit analysis configuration should have correlation enabled","run_time":5.6927e-05,"start_time":"2025-05-04T22:09:08-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Audit analysis configuration"},{"status":"passed","code_desc":"Audit analysis configuration should have correlation methods configured","run_time":4.5225e-05,"start_time":"2025-05-04T22:09:08-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Audit analysis configuration"},{"status":"passed","code_desc":"Audit reporting configuration should have reporting enabled","run_time":5.7909e-05,"start_time":"2025-05-04T22:09:08-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Audit reporting configuration"},{"status":"passed","code_desc":"Audit reporting configuration should have appropriate reporting frequency","run_time":4.4634e-05,"start_time":"2025-05-04T22:09:08-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Audit reporting configuration"},{"status":"passed","code_desc":"Audit reporting configuration should have report recipients configured","run_time":0.000119959,"start_time":"2025-05-04T22:09:08-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Audit reporting configuration"},{"status":"passed","code_desc":"Risk-based adjustment configuration should have risk-based adjustment enabled","run_time":0.000109435,"start_time":"2025-05-04T22:09:08-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Risk-based adjustment configuration"},{"status":"passed","code_desc":"Risk-based adjustment configuration should have risk levels configured","run_time":8.0691e-05,"start_time":"2025-05-04T22:09:08-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Risk-based adjustment configuration"},{"status":"passed","code_desc":"OPA policy validation for audit review should contain audit review validation in OPA logs","run_time":0.010059012,"start_time":"2025-05-04T22:09:08-06:00","resource_class":"Object","resource_params":"[]","resource_id":"OPA policy validation for audit review"},{"status":"passed","code_desc":"Audit findings reporting should have findings available","run_time":0.000235301,"start_time":"2025-05-04T22:09:08-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Audit findings reporting"},{"status":"passed","code_desc":"Audit findings reporting should include required information in findings","run_time":7.1023e-05,"start_time":"2025-05-04T22:09:08-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Audit findings reporting"},{"status":"passed","code_desc":"Audit review process should complete the review process","run_time":6.5682e-05,"start_time":"2025-05-04T22:09:08-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Audit review process"},{"status":"passed","code_desc":"Audit review process should analyze audit records","run_time":4.9292e-05,"start_time":"2025-05-04T22:09:08-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Audit review process"},{"status":"passed","code_desc":"Audit review process should identify findings if applicable","run_time":4.9182e-05,"start_time":"2025-05-04T22:09:08-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Audit review process"},{"status":"passed","code_desc":"Audit review process should report findings to recipients","run_time":4.7189e-05,"start_time":"2025-05-04T22:09:08-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Audit review process"},{"status":"passed","code_desc":"Integration with risk assessment should adjust review frequency based on risk","run_time":5.0184e-05,"start_time":"2025-05-04T22:09:08-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Integration with risk assessment"},{"status":"passed","code_desc":"Integration with risk assessment should adjust analysis methods based on risk","run_time":5.1485e-05,"start_time":"2025-05-04T22:09:08-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Integration with risk assessment"},{"status":"passed","code_desc":"Integration with risk assessment should adjust reporting frequency based on risk","run_time":4.6015e-05,"start_time":"2025-05-04T22:09:08-06:00","resource_class":"Object","resource_params":"[]","resource_id":"Integration with risk assessment"}]}],"status":"loaded","status_message":""}],"statistics":{"duration":0.040043983},"version":"6.8.11"}